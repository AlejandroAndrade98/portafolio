:root {
  --pointer-x: 50%;
  --pointer-y: 50%;
  --pointer-from-center: 0;
  --pointer-from-top: 0.5;
  --pointer-from-left: 0.5;
  --card-opacity: 0;

  --rotate-x: 0deg;
  --rotate-y: 0deg;

  --background-x: 50%;
  --background-y: 50%;

  --grain: none;
  --icon: none;

  --behind-glow-color: rgba(80, 160, 255, 0.55);
  --behind-glow-size: 55%;

  --inner-gradient: none;
  --card-radius: 30px;

  /* tamaños */
  --pc-pattern-size: clamp(360px, 46vw, 600px); /* figuras GRANDES */
  --pc-grain-size: clamp(1200px, 140vw, 2600px); /* grain ENORME */

  /* base */
  --pc-deep: rgba(6, 10, 18, 0.92);
}

.pc-card-wrapper {
  position: relative;
  perspective: 700px;
  transform: translate3d(0, 0, 0.1px);
  touch-action: pan-y;
}

.pc-behind {
  position: absolute;
  inset: 0;
  z-index: 0;
  pointer-events: none;

  background: radial-gradient(
    circle at var(--pointer-x) var(--pointer-y),
    var(--behind-glow-color) 0%,
    transparent var(--behind-glow-size)
  );

  /* ✅ PERF: blur menos agresivo + contain */
  contain: paint;
  filter: blur(22px) saturate(1.04);

  opacity: calc(0.85 * var(--card-opacity));
  transition: opacity 200ms ease;
}

.pc-card-wrapper.active {
  --card-opacity: 1;
}

.pc-card-shell {
  position: relative;
  z-index: 1;
  isolation: isolate;
  pointer-events: auto;

  /* ✅ PERF: reduce radio de repaints */
  contain: layout paint style;
}

.pc-card {
  height: 80svh;
  max-height: 540px;
  aspect-ratio: 0.718;
  border-radius: var(--card-radius);

  position: relative;
  overflow: hidden;
  backface-visibility: hidden;

  background: var(--pc-deep);

  box-shadow:
    rgba(0, 0, 0, 0.85)
      calc((var(--pointer-from-left) * 10px) - 3px)
      calc((var(--pointer-from-top) * 20px) - 6px)
      22px -6px;

  transform: translateZ(0) rotateX(0deg) rotateY(0deg);
  transition: transform 600ms ease;
}

.pc-card-wrapper.active .pc-card {
  transition: none;
  transform: translateZ(0) rotateX(var(--rotate-y)) rotateY(var(--rotate-x));
}

.pc-card-shell.entering .pc-card {
  transition: transform 160ms ease-out;
}

.pc-inside {
  position: absolute;
  inset: 0;
  border-radius: var(--card-radius);
  background-image: var(--inner-gradient);
  background-color: var(--pc-deep);
}

/* base layers */
.pc-content {
  position: absolute;
  inset: 0;
  border-radius: var(--card-radius);
  pointer-events: none;
}

.pc-layer {
  position: absolute;
  inset: 0;
  border-radius: var(--card-radius);
  pointer-events: none;
}

/* ======= AVATAR ======= */
.pc-avatar-content {
  z-index: 5;
  overflow: hidden;
}

.pc-avatar-layer {
  position: absolute;
  inset: 0;
  border-radius: var(--card-radius);
  overflow: hidden;

  transform-origin: 50% 100%;
  transform:
    translateX(calc((var(--pointer-from-left) - 0.5) * 8px))
    translateY(calc((var(--pointer-from-top) - 0.5) * 4px))
    scaleX(calc(1 + (var(--pointer-from-left) - 0.5) * 0.02))
    scaleY(calc(1 + (var(--pointer-from-top) - 0.5) * 0.03));

  will-change: transform;

  /* ✅ PERF: transición solo en idle (tu tiltEngine ya suaviza) */
  transition: transform 180ms ease-out;
  z-index: 1;
}

/* ✅ PERF: cuando hay RAF, sin transición (evita trabajo extra por frame) */
.pc-card-wrapper.active .pc-avatar-layer {
  transition: none;
}

.pc-avatar-layer .avatar {
  object-fit: cover;
  object-position: center;
  transform: translateZ(0);

  filter: grayscale(1) contrast(1.18) brightness(0.74);
}

/* ======= AZUL (para que NO se vea gris) ======= */
.pc-tint {
  z-index: 2;
  background: radial-gradient(
    circle at 50% 22%,
    rgba(110, 180, 255, 0.36) 0%,
    rgba(50, 120, 255, 0.18) 30%,
    rgba(0, 0, 0, 0.62) 78%
  );
  mix-blend-mode: color;
  opacity: 0.58;
}

/* viñeta suave */
.pc-vignette {
  z-index: 3;
  background: radial-gradient(
    circle at 50% 40%,
    rgba(0,0,0,0.0) 0%,
    rgba(0,0,0,0.28) 58%,
    rgba(0,0,0,0.65) 100%
  );
  opacity: 0.85;
}

/* ======= PATRÓN BASE ======= */
.pc-pattern {
  z-index: 4;
  background: rgba(255,255,255,0.18);

  -webkit-mask-image: var(--icon);
  -webkit-mask-repeat: repeat;
  -webkit-mask-size: var(--pc-pattern-size);
  -webkit-mask-position: 50% 30%;

  mask-image: var(--icon);
  mask-repeat: repeat;
  mask-size: var(--pc-pattern-size);
  mask-position: 50% 30%;

  opacity: 0.10;
  mix-blend-mode: overlay;

  /* ✅ PERF: no dejes will-change siempre activo */
  will-change: auto;
}

/* ======= WAVE ======= */
.pc-wave {
  z-index: 5;

  background-image: linear-gradient(
    115deg,
    transparent 0%,
    rgba(90,160,255,0.00) 34%,
    rgba(90,160,255,0.95) 50%,
    rgba(34,211,238,0.55) 58%,
    transparent 72%
  );

  background-size: 240% 240%;
  background-position: 130% -12%;

  -webkit-mask-image: var(--icon);
  -webkit-mask-repeat: repeat;
  -webkit-mask-size: var(--pc-pattern-size);
  -webkit-mask-position: 50% 30%;

  mask-image: var(--icon);
  mask-repeat: repeat;
  mask-size: var(--pc-pattern-size);
  mask-position: 50% 30%;

  mix-blend-mode: screen;

  /* ✅ PERF: sin drop-shadow base (pesado) */
  filter: none;
  opacity: 0.0;

  /* ✅ PERF: no dejes will-change siempre activo */
  will-change: auto;
}

/* idle: ola visible sin hover */
.pc-card-wrapper:not(.active) .pc-wave {
  opacity: 0.75;
  animation: pcWaveTRTL 6.6s ease-in-out infinite;
}

/* hover/active */
.pc-card-wrapper.active .pc-pattern {
  opacity: 0.16;
}

/* ✅ PERF: activa will-change solo cuando importa */
.pc-card-wrapper.active .pc-pattern,
.pc-card-wrapper.active .pc-wave {
  will-change: opacity, background-position;
}

.pc-card-wrapper.active .pc-wave {
  opacity: 1;
  animation: none;

  background-position: var(--background-x) -8%;

  /* ✅ filtro más suave (desktop) */
  filter:
    drop-shadow(0 0 10px rgba(90,160,255,0.38))
    drop-shadow(0 0 18px rgba(34,211,238,0.12));
}

@keyframes pcWaveTRTL {
  0% {
    background-position: 130% -12%;
    opacity: 0;
  }
  18% { opacity: 0.55; }
  50% {
    background-position: -30% -6%;
    opacity: 0.95;
  }
  78% { opacity: 0.25; }
  100% {
    background-position: 130% -12%;
    opacity: 0;
  }
}

/* ✅ PERF: en mobile/tablet evita repaints constantes del background-position */
@media (max-width: 1024px) {
  .pc-card-wrapper:not(.active) .pc-wave {
    animation: none !important;
    opacity: 0.35;
  }

  .pc-card-wrapper.active .pc-wave {
    filter: none; /* sin drop-shadow */
  }
}

/* ======= GRAIN ======= */
.pc-grain {
  z-index: 6;

  background-image: var(--grain);
  background-repeat: repeat;
  background-size: var(--pc-grain-size);
  background-position: var(--background-x) var(--background-y);

  opacity: 0.13;
  mix-blend-mode: soft-light;
}

/* ======= SHINE / GLARE ======= */
.pc-shine {
  z-index: 7;
  background-image: radial-gradient(
    farthest-corner circle at var(--pointer-x) var(--pointer-y),
    rgba(120, 190, 255, 0.14) 0%,
    rgba(0, 0, 0, 0.35) 58%,
    rgba(0, 0, 0, 0.70) 110%
  );
  mix-blend-mode: screen;
  opacity: 0.04;
  transition: opacity 220ms ease;
}

.pc-card-wrapper.active .pc-shine {
  opacity: 0.12;
}

.pc-glare {
  z-index: 8;
  background-image: radial-gradient(
    farthest-corner circle at var(--pointer-x) var(--pointer-y),
    rgba(220, 235, 255, 0.20) 0%,
    rgba(40, 90, 160, 0.14) 45%,
    rgba(0, 0, 0, 0.60) 100%
  );
  mix-blend-mode: overlay;
  opacity: 0.04;
  transition: opacity 220ms ease;
}

.pc-card-wrapper.active .pc-glare {
  opacity: 0.10;
}

/* ======= TOP TEXT ======= */
.pc-toptext {
  z-index: 20;
  mix-blend-mode: normal;
}

.pc-details {
  position: absolute;
  top: 22px;
  left: 0;
  right: 0;
  text-align: center;
  display: grid;
  gap: 2px;
  padding: 0 10px;
}

.pc-details h3,
.pc-details p {
  margin: 0;
  letter-spacing: 0.01em;
  text-shadow:
    0 10px 30px rgba(0,0,0,0.45),
    0 2px 6px rgba(0,0,0,0.25);
}

.pc-details h3 {
  font-weight: 700;
  font-size: clamp(1.35rem, 2.15vw, 2.00rem);
  line-height: 1.05;

  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;

  background-image: linear-gradient(
    180deg,
    #ffffff 0%,
    #d7e3ff 18%,
    #9cabdb 45%,
    #ffffff 65%,
    #a8b7ff 100%
  );
  -webkit-text-fill-color: transparent;
  background-clip: text;
  -webkit-background-clip: text;
}

.pc-details p {
  font-weight: 700;
  font-size: clamp(1.05rem, 1.25vw, 1.22rem);
  line-height: 1.1;
  white-space: nowrap;

  background-image: linear-gradient(
    180deg,
    #ffffff 0%,
    #d0dcff 28%,
    #ffffff 62%,
    #a3a9fd 100%
  );
  -webkit-text-fill-color: transparent;
  background-clip: text;
  -webkit-background-clip: text;
  opacity: 0.95;
}

/* ======= BOTTOM UI ======= */
.pc-user-info {
  position: absolute;
  left: 18px;
  right: 18px;
  bottom: 18px;
  z-index: 30;

  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 12px;

  background: rgba(255, 255, 255, 0.10);
  backdrop-filter: blur(12px);
  border: 1px solid rgba(255, 255, 255, 0.14);
  border-radius: 18px;
  padding: 12px 14px;

  pointer-events: auto;
}

/* ✅ PERF: en mobile, quita backdrop-filter */
@media (max-width: 768px) {
  .pc-user-info {
    backdrop-filter: none;
    background: rgba(255,255,255,0.12);
  }
}

.pc-user-details {
  display: flex;
  align-items: center;
  gap: 12px;
  min-width: 0;
  flex: 1 1 auto;
}

.pc-mini-avatar {
  width: 48px;
  height: 48px;
  border-radius: 999px;
  overflow: hidden;
  border: 1px solid rgba(255, 255, 255, 0.16);
  flex-shrink: 0;
  position: relative;
}

.pc-mini-avatar-img {
  width: 48px;
  height: 48px;
  object-fit: cover;
  border-radius: 999px;
}

.pc-mini-avatar-img.is-fallback {
  opacity: 0.6;
}

.pc-user-text {
  display: grid;
  gap: 6px;
}

.pc-handle {
  font-size: 14px;
  font-weight: 600;
  color: rgba(255, 255, 255, 0.92);
  line-height: 1;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.pc-status {
  font-size: 12px;
  font-weight: 500;
  color: rgba(255, 255, 255, 0.72);
  line-height: 1;
}

.pc-contact-btn {
  pointer-events: auto;
  cursor: pointer;

  border: 1px solid rgba(255, 255, 255, 0.18);
  border-radius: 12px;
  padding: 10px 14px;

  background: rgba(255, 255, 255, 0.08);
  color: rgba(255, 255, 255, 0.92);
  font-size: 12px;
  font-weight: 700;

  transition: transform 160ms ease, border-color 160ms ease, background 160ms ease;

  white-space: nowrap;
}

.pc-contact-btn:hover {
  transform: translateY(-1px);
  border-color: rgba(255, 255, 255, 0.35);
  background: rgba(255, 255, 255, 0.12);
}

/* ======= Responsive ======= */
@media (max-width: 768px) {
  .pc-card { height: 70svh; max-height: 460px; }
  .pc-details h3 { font-size: min(4svh, 2.1rem); }
  .pc-details p { font-size: 0.92rem; }
  .pc-mini-avatar, .pc-mini-avatar-img { width: 34px; height: 34px; }
}

@media (max-width: 480px) {
  .pc-card { height: 62svh; max-height: 390px; }
  .pc-details { top: 18px; }
  .pc-details h3 { font-size: min(3.6svh, 1.85rem); }
  .pc-user-info { left: 14px; right: 14px; bottom: 14px; padding: 10px 12px; }
}

/* Reduce Motion */
@media (prefers-reduced-motion: reduce) {
  .pc-card,
  .pc-avatar-layer {
    transition: none !important;
  }

  .pc-card-wrapper:not(.active) .pc-wave {
    animation: none !important;
    opacity: 0.28;
  }
}
